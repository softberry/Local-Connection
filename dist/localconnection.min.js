"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var LocalConnection=function(){function e(n){_classCallCheck(this,e);var t=this;window.LC=t,t.key=n.key,t.name=n.name,t.frames=n.frames,t.timeout=Number.parseInt(n.timeout,10)||0,t.onConnect=n.onConnect||function(){},t.onTimeout=n.onTimeout||function(){},t._timestamp=0,t.connected=!1,t.CustomError=function(e){this.name="LocalConnectionCusomError. https://github.com/softberry/Local-Connection",this.message=e},t.missingOptions(n)||(t._timestamp=0===t.timeout?0:Date.now()+1e3*t.timeout,window.addEventListener?window.addEventListener("load",function(){t.ready=!0}):window.attachEvent("onload",function(){t.ready=!0}),t.ready="complete"===window.document.readyState,t.reconnect())}return _createClass(e,[{key:"missingOptions",value:function(e){var n=this;try{if("object"!==(void 0===e?"undefined":_typeof(e)))throw new n.CustomError("LocalConnection required options key,name,frames must be defined!");if(!e.key)throw new n.CustomError("key (UniqueKey) must be defined ");if(!e.name)throw new n.CustomError("name is not defined. Each document needs a name as string (a-z,A-Z,0-9)");if(!e.frames)throw new n.CustomError("frames are not defined. Give other document names in array");if("string"==typeof e.frames&&(e.frames=e.frames.split(",")),!Array.isArray(e.frames)||0===e.frames.length)throw new n.CustomError("frame names should be comma separated string or an Array of stings.")}catch(e){return!0}return!1}},{key:"reconnect",value:function(){var e=this;if(e.timeout>0&&Date.now()>e._timestamp)return e.onTimeout();if(window.parent===window)return e.onTimeout();var n=0;for(n=0;n<e.frames.length;n++)e[e.frames[n]]=e[e.frames[n]]||e.getFrameByName(e.frames[n]);e.connected=e.isConnected(),e.connected?e.onConnect():window.setTimeout(function(){e.reconnect()},1e3)}},{key:"isConnected",value:function(){for(var e=!0,n=this,t=0;t<n.frames.length;t++)null===n[n.frames[t]]&&(e=!1);return e}},{key:"getFrameByName",value:function(e){var n=this;if(e===n.name)return window;var t=window;function r(e,t){for(var o=0;o<e.length;){var a=e.frames[o];if(o++,a.frames.length>0&&!n[t]){var i=r(a,t);if(null!==i)return i}var u=n.checkFrame(a,t);if(null!==u)return u}return null}for(;t!==t.parent;)t=t.parent;for(var o=0;o<t.frames.length;){var a=t.frames[o];if(o++,a.frames.length>0&&!n[e]){var i=r(a,e);if(null!==i)return i}var u=null;try{u=void 0===a.LC?null:n.checkFrame(a,e)}catch(e){}if(null!==u)return u}return null}},{key:"checkFrame",value:function(e,n){try{if(e.LC.key===this.key&&e.LC.name===n&&e.LC.ready)return this.pair(window),e}catch(e){return null}return null}},{key:"pair",value:function(e){var n=this;e.LC.key===n.key&&(n[e.LC.name]=e),n.connected||n.isConnected()&&(n.connected=!0,n.onConnect())}}]),e}();window.LocalConnection=LocalConnection;